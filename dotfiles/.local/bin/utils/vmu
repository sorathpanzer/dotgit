#!/bin/bash

#Verify if vmu folder exists

if [ $1 == "create" ]; then
    echo "Size for the virtual disk?"
    read SIZE
    echo "Name for the disk"
    read NAME
    qemu-img create -f qcow2 $HOME/.local/share/vmu/$NAME.img $SIZE"G"
    echo "Created $NAME virtual disk with $SIZE G"
    qemu-system-x86_64 -enable-kvm -cdrom $HOME/Transferências/$(ls $HOME/Transferências | grep iso | fzf) -boot order=c -drive file=$HOME/.local/share/vmu/$NAME.img -m 4G -cpu host -vga virtio -display sdl,gl=on
fi

if [ $1 == "install" ]; then
    qemu-system-x86_64 -enable-kvm -cdrom $HOME/Transferências/$(ls $HOME/Transferências | grep iso | fzf) -boot menu=on -drive file=$HOME/.local/share/vmu/$2.img -m 4G -cpu host -vga virtio -display sdl,gl=on
fi

if [ $1 == "boot" ]; then
    qemu-system-x86_64 -enable-kvm -boot order=d -drive file=$HOME/.local/share/vmu/$(ls $HOME/.local/share/vmu | cut -f1 -d'.' | fzf).img -m 4G -cpu host -vga virtio -display sdl,gl=on
fi

if [ $1 == "snapshot" ]; then
    DISK="$HOME/.local/share/vmu/$(ls $HOME/.local/share/vmu | cut -f1 -d'.' | fzf)"
    echo "Give a name for the snapshot:"
    read SNAPNAME
    echo "Creating Snapshot..."
    cp $DISK.img $DISK-$SNAPNAME.img
fi

if [ $1 == "remove" ]; then
    rm $HOME/.local/share/vmu/$(ls $HOME/.local/share/vmu | cut -f1 -d'.' | fzf).img
fi

if ! [[ $1 =~ ^(create|install|boot|help|snapshot|remove|list)$ ]]; then
    qemu-system-x86_64 -enable-kvm -boot order=d -drive file=$HOME/.local/share/vmu/$1.img -m 4G -cpu host -vga virtio -display sdl,gl=on &
fi


if [ $1 == "list" ]; then
    ls $HOME/.local/share/vmu
fi

if [ $1 == "help" ]; then
    echo "vmu create....................... Create a disk and boot iso
vmu install...................... Boot install iso in specific disk
vmu <NAMEDISK>................... Boot disk
vmu boot......................... Boot disk
vmu snapshot..................... Snapshot of a specific disk
vmu remove....................... Remove disk
vmu list......................... List disks"
fi
